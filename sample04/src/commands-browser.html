<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>E2E Encryption Test</title>
  <script src="../node_modules/@babel/polyfill/browser.js"></script>
  <script src="../node_modules/js-crypto-utils/dist/jscu.bundle.min.js"></script>
  <script src="../dist/e2eTest.bundle.js"></script>
</head>
<body>
<script type="text/javascript">
  //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  const toBeHashed = 'hello hash world';
  const hashName = 'SHA-256';
  const genHash = async () => {
    console.log(`Compute hash value\n=======\n`);
    console.log(`<Input Data>\n${toBeHashed}`);

    // generate Hash
    const hashed = await e2eTest.genHash(toBeHashed, hashName);
    console.log(`<Computed Hash (HEX)>\n${e2eTest.util.arrayBufferToHexString(hashed)}\n=======\n`);
  };

  //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  const toBeHMACed = 'hello hmac world';
  const hashNameHMAC = 'SHA-256';
  const checkHMAC = async () => {
    console.log(`Compute HMAC value\n=======\n`);
    console.log(`<Input Data>\n${toBeHMACed}`);
    const key = e2eTest.util.arrayBufferToHexString(jscu.random.getRandomBytes(32));
    console.log(`<Generated Hex Key>\n${key}`);

    const hmac = e2eTest.util.arrayBufferToHexString(await e2eTest.genHmac(toBeHMACed, key, hashNameHMAC));
    console.log(`<Generated HMAC>\n${hmac}`);

    const verify = await e2eTest.verifyHmac(toBeHMACed, key, hmac, hashNameHMAC);
    console.log(`<HMAC Verification Result>\n${verify}\n=======\n`);
  };
  //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  genHash()
    .then( () => {
      return checkHMAC();
    })
    .then( (r) => r);
</script>
</body>
</html>
